---
import BaseLayout from "../layouts/BaseLayout.astro";
import "../styles/cardCarousel.css";
import { getCollection } from "astro:content";
import { marked } from "marked";
import fs from "node:fs";
import path from "node:path";
import LazyImage from "../components/LazyImage.astro";

// Get all about sections and sort by order
const aboutSections = await getCollection("about");
const sortedSections = aboutSections.sort(
  (a, b) => a.data.order - b.data.order
);

// Convert markdown to HTML for proper rendering
sortedSections.forEach((section) => {
  section.compiledContent = marked.parse(section.body);
});

// Base URL for assets
const baseUrl = import.meta.env.BASE_URL;

// Get all logo files from the directory
const logoDir = path.join(process.cwd(), "public", "logos");
let logoFiles: string[] = [];

try {
  if (fs.existsSync(logoDir)) {
    logoFiles = fs
      .readdirSync(logoDir)
      .filter((file) => !file.startsWith(".") && file !== "README.md")
      .filter((file) => /\.(svg|png|jpg|jpeg)$/i.test(file));
  }
} catch (error) {
  console.error("Error reading logo directory:", error);
}

// Convert logo filename to a display name
function getDisplayName(filename) {
  const nameWithoutExt = filename.split(".")[0];
  return nameWithoutExt
    .split("-")
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ");
}
---

<BaseLayout title="About">
  <section class="py-10">
    <div class="container mx-auto px-4">
      <h1 class="text-4xl font-bold mb-8 text-center font-serif">
        About APR Artist Agency
      </h1>

      <div class="card-carousel">
        {
          sortedSections.map((section, index) => (
            <div class="carousel-card" data-index={index}>
              <div class="card-content bg-dark-card p-8 rounded-lg shadow-card">
                <h2 class="text-2xl font-bold mb-4 text-gold font-serif">
                  {section.data.title}
                </h2>

                {/* Display the markdown body content with proper HTML rendering */}
                <div
                  class="text-primary markdown-content"
                  set:html={section.compiledContent}
                />
              </div>
            </div>
          ))
        }
      </div>

      <div class="progress-bar">
        <div class="progress-indicator"></div>
      </div>
    </div>
  </section>

  <!-- Partners & Clients Section -->
  <section class="py-16 md:py-24 bg-dark-card">
    <div class="container mx-auto px-4">
      <h2
        class="text-3xl md:text-4xl font-bold text-center mb-12 md:mb-16 font-serif"
      >
        OUR PARTNERS & CLIENTS
      </h2>

      <div
        class="grid grid-cols-[repeat(auto-fit,minmax(8rem,1fr))] justify-items-center items-center"
      >
        {
          logoFiles.length > 0 ? (
            logoFiles.map((file) => (
              <div class="p-4">
                <img
                  src={`${baseUrl}/logos/${file}`}
                  alt={`Logo of ${getDisplayName(file)}`}
                  class="max-h-16 w-auto"
                />
              </div>
            ))
          ) : (
            <div class="col-span-full text-center text-secondary">
              No client logos found. Add logo files to the public/logos
              directory.
            </div>
          )
        }
      </div>
    </div>
  </section>

  <section class="py-16 md:py-24 bg-dark-lighter">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-10 items-center">
        <div>
          <LazyImage
            src={`${import.meta.env.BASE_URL}/team/ceo.jpg`}
            alt="Alan Rajendram, CEO"
            class="rounded-xl shadow-lg"
          />
        </div>
        <div>
          <h2 class="text-3xl md:text-4xl font-bold mb-6 font-serif">
            Our Vision
          </h2>
          <p class="text-lg mb-4 text-primary">
            APR Artist Agency was founded with a simple vision: to bridge the
            gap between artistic vision and commercial success. We believe that
            true innovation happens when creators are empowered to express their
            unique perspectives while connecting with audiences in meaningful
            ways.
          </p>
          <p class="text-lg mb-6 text-primary">
            Our team of industry professionals works tirelessly to nurture these
            connections, creating partnerships that respect artistic integrity
            while delivering exceptional value to brands and their consumers.
          </p>
          <div class="flex items-center mt-8">
            <LazyImage
              src={`${import.meta.env.BASE_URL}/team/ceo-signature.png`}
              alt="Alan Rajendram Signature"
              class="h-16"
            />
            <div class="ml-4">
              <p class="font-bold text-primary">Alan Rajendram</p>
              <p class="text-sm text-gold">Founder & CEO</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  import { initCardCarousel } from "../scripts/cardCarousel.js";

  document.addEventListener("astro:page-load", () => {
    initCardCarousel();
  });
</script>
