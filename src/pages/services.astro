---
import BaseLayout from "../layouts/BaseLayout.astro";
import LazyImage from "../components/LazyImage.astro";
import { getCollection } from "astro:content";
import { marked } from "marked";

// Helper function to create URL-friendly slugs
function slugify(text) {
  if (!text) return "";
  return text
    .toString()
    .toLowerCase()
    .trim()
    .replace(/\s+/g, "-")
    .replace(/[^\w-]+/g, "")
    .replace(/--+/g, "-")
    .replace(/^-+/, "")
    .replace(/-+$/, "");
}

const services = await getCollection("services");
const sortedServices = services.sort((a, b) => a.data.order - b.data.order);

sortedServices.forEach((service) => {
  service.data.id = slugify(service.data.title);
  service.compiledContent = marked.parse(service.body);
});
---

<BaseLayout title="Services">
  <div class="services-page">
    <div class="hero-section py-8 md:py-8">
      <div class="container mx-auto px-4 text-center">
        <h1
          class="text-4xl md:text-4xl font-serif text-heading mb-6 animate-fade-in"
        >
          Our Services
        </h1>
        <p
          class="text-lg md:text-xl max-w-3xl mx-auto animate-fade-in animation-delay-200"
        >
          We deliver comprehensive solutions tailored to elevate your brand
        </p>
      </div>
    </div>

    <!-- Services Overview Grid -->
    <section class="py-8 bg-dark-lighter">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          <h2
            class="text-3xl md:text-4xl font-bold mb-12 text-center font-serif text-heading"
          >
            Our Expertise
          </h2>

          <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12"
          >
            <div class="text-center">
              <div class="text-primary mb-6">
                <svg
                  class="w-12 h-12 mx-auto"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold mb-4 font-serif text-heading">
                Brand Partnerships
              </h3>
              <p class="text-secondary leading-relaxed">
                Strategic collaborations, endorsement deals, brand licensing,
                and influencer activations that drive results.
              </p>
            </div>

            <div class="text-center">
              <div class="text-primary mb-6">
                <svg
                  class="w-12 h-12 mx-auto"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M7 4V2a1 1 0 011-1h4a1 1 0 011 1v2h4a1 1 0 110 2h-1v10a2 2 0 01-2 2H6a2 2 0 01-2-2V6H3a1 1 0 010-2h4z"
                  ></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold mb-4 font-serif text-heading">
                Public Relations
              </h3>
              <p class="text-secondary leading-relaxed">
                Media engagement, reputation management, event appearances, and
                storytelling that builds lasting connections.
              </p>
            </div>

            <div class="text-center">
              <div class="text-primary mb-6">
                <svg
                  class="w-12 h-12 mx-auto"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"
                  ></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold mb-4 font-serif text-heading">
                Sponsorship Solutions
              </h3>
              <p class="text-secondary leading-relaxed">
                Tours, festivals, sports events, and exclusive experiences
                tailored to your objectives.
              </p>
            </div>

            <div class="text-center">
              <div class="text-primary mb-6">
                <svg
                  class="w-12 h-12 mx-auto"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  ></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold mb-4 font-serif text-heading">
                Marketing Strategy
              </h3>
              <p class="text-secondary leading-relaxed">
                Product placement, merchandise creation, and comprehensive
                campaign monitoring and optimization.
              </p>
            </div>

            <div class="text-center">
              <div class="text-primary mb-6">
                <svg
                  class="w-12 h-12 mx-auto"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"
                  ></path>
                  <path
                    fill-rule="evenodd"
                    d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
                    clip-rule="evenodd"></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold mb-4 font-serif text-heading">
                Premium Services
              </h3>
              <p class="text-secondary leading-relaxed">
                Access to exclusive locations, studio facilities, and concierge
                services for seamless experiences.
              </p>
            </div>

            <div class="text-center">
              <div class="text-primary mb-6">
                <svg
                  class="w-12 h-12 mx-auto"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                    clip-rule="evenodd"></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold mb-4 font-serif text-heading">
                Campaign Excellence
              </h3>
              <p class="text-secondary leading-relaxed">
                Social media innovations, B2B partnerships, and VIP event access
                that boost brand awareness.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="container mx-auto px-4">
      <div class="services-accordion max-w-4xl mx-auto">
        {
          sortedServices.map((service, index) => {
            // Generate appropriate icon based on service type
            let serviceIcon =
              service.data.icon ||
              `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>`;

            return (
              <div
                class="accordion-item shadow-card mb-4 opacity-0 translate-y-8 animation-item"
                id={service.data.id}
                style={`animation-delay: ${index * 150}ms`}
              >
                <div
                  class="accordion-header flex justify-between items-center p-6 bg-dark-lighter cursor-pointer border-l-4 border-transparent hover:border-primary"
                  data-accordion-id={service.data.id}
                >
                  <h2 class="text-2xl font-serif flex items-center">
                    <span
                      class="service-icon text-primary"
                      set:html={serviceIcon}
                    />
                    {service.data.title}
                  </h2>
                  <div class="accordion-icon">
                    <svg
                      class="w-6 h-6"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      />
                    </svg>
                  </div>
                </div>
                <div
                  class="accordion-content overflow-hidden transition-all duration-300 max-h-0"
                  data-content-id={service.data.id}
                >
                  <div class="p-6 bg-dark-card">
                    {service.data.image && (
                      <div class="service-image-container mb-8">
                        <LazyImage
                          src={service.data.image}
                          alt={service.data.title}
                          class="w-full rounded-md object-cover h-48 md:h-64"
                        />
                      </div>
                    )}
                    <div
                      class="prose prose-invert prose-lg max-w-none"
                      set:html={service.compiledContent}
                    />
                  </div>
                </div>
              </div>
            );
          })
        }
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .services-accordion {
    display: flex;
    flex-direction: column;
    gap: 0; /* No gap between items */
  }

  .accordion-item {
    display: block;
    width: 100%;
    border-radius: 0.375rem;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .accordion-header {
    transition: all 0.3s ease;
  }

  .accordion-header.active {
    border-left-color: theme("colors.primary.DEFAULT");
    background-color: theme("colors.dark.card");
  }

  .accordion-icon {
    transition: transform 0.3s ease;
  }

  .accordion-header.active .accordion-icon {
    transform: rotate(90deg);
  }

  .accordion-header.active .accordion-icon svg {
    color: theme("colors.primary.DEFAULT");
  }

  .accordion-content {
    max-height: 0;
    opacity: 0;
    transition: all 0.5s ease;
    overflow: hidden;
  }

  .accordion-content.active {
    max-height: 2000px; /* Large enough to contain content */
    opacity: 1;
  }

  .service-image-container {
    transition: all 0.5s ease;
    transform: translateY(20px);
    opacity: 0;
  }

  .accordion-content.active .service-image-container {
    transform: translateY(0);
    opacity: 1;
    transition-delay: 0.2s;
  }

  .service-icon svg {
    fill: none;
    transition: all 0.3s ease;
  }

  .accordion-header.active .service-icon svg {
    color: theme("colors.primary.DEFAULT");
  }

  /* Animation classes */
  .animation-item {
    animation: fadeUp 0.8s ease forwards;
  }

  .animate-fade-in {
    opacity: 0;
    animation: fadeIn 1s ease forwards;
  }

  .animation-delay-200 {
    animation-delay: 200ms;
  }

  @keyframes fadeUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Restore prose headings styling */
  .prose h3 {
    color: theme("colors.primary.DEFAULT");
    margin-top: 1.5rem;
    margin-bottom: 1rem;
  }
</style>

<script>
  document.addEventListener("astro:page-load", () => {
    initAccordion();
  });

  function initAccordion() {
    const accordionHeaders = document.querySelectorAll(".accordion-header");

    accordionHeaders.forEach((header) => {
      header.addEventListener("click", () => {
        const accordionId = header.getAttribute("data-accordion-id");
        const content = document.querySelector(
          `.accordion-content[data-content-id="${accordionId}"]`
        );

        // Toggle active state for clicked accordion
        const isActive = header.classList.contains("active");

        // Close all accordions first
        accordionHeaders.forEach((h) => h.classList.remove("active"));
        document
          .querySelectorAll(".accordion-content")
          .forEach((c) => c.classList.remove("active"));

        // If it wasn't active before, make it active now
        if (!isActive) {
          header.classList.add("active");
          content?.classList.add("active");

          // Scroll to the header if it's not fully visible
          setTimeout(() => {
            const headerRect = header.getBoundingClientRect();
            const isVisible =
              headerRect.top >= 0 && headerRect.bottom <= window.innerHeight;

            if (!isVisible) {
              header.scrollIntoView({ behavior: "smooth", block: "start" });
            }
          }, 100);
        }
      });
    });

    // Check for hash in URL and open that accordion
    if (window.location.hash) {
      const id = window.location.hash.substring(1);
      const header = document.querySelector(
        `.accordion-header[data-accordion-id="${id}"]`
      );
      const content = document.querySelector(
        `.accordion-content[data-content-id="${id}"]`
      );

      if (header && content) {
        // Close all accordions first
        accordionHeaders.forEach((h) => h.classList.remove("active"));
        document
          .querySelectorAll(".accordion-content")
          .forEach((c) => c.classList.remove("active"));

        // Open the one matching the hash
        header.classList.add("active");
        content.classList.add("active");

        // Scroll to it
        setTimeout(() => {
          header.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 300);
      }
    }
  }
</script>
